To apply these restrictions at the domain level, follow these steps using Group Policy Management (GPMC) on a Windows Server Active Directory (AD) environment.


---

Step 1: Block .library-ms Execution via AppLocker (Domain-wide)

This ensures users cannot execute .library-ms files anywhere in the domain.

1. Open Group Policy Management Console (GPMC) (gpmc.msc).


2. Create/Edit a GPO:

Right-click your domain or OU (Organizational Unit) containing users.

Select "Create a GPO in this domain, and Link it here..."

Name it "Restrict Library Files".



3. Navigate to AppLocker Policies:

Computer Configuration → Windows Settings → Security Settings → Application Control Policies → AppLocker → Script Rules


4. Right-click Script Rules → Create New Rule.


5. Select "Deny" → Apply to "Everyone".


6. Select Path Condition → Enter:

*\*.library-ms


7. Finish & Apply the policy.



✅ Effect: .library-ms files cannot execute on any domain-joined machines.


---

Step 2: Prevent .library-ms File Creation via NTFS ACL (Domain-wide)

Modify Folder Redirection Policies or use Group Policy Preferences to set NTFS permissions.

1. Open GPMC and Edit the same GPO.


2. Navigate to:

Computer Configuration → Preferences → Windows Settings → Files


3. Right-click Files → New → File

Action: Delete

Path: C:\Users\%USERNAME%\AppData\Roaming\Microsoft\Windows\Libraries\*.library-ms



4. Navigate to Folder Permissions:

Computer Configuration → Policies → Windows Settings → Security Settings → File System


5. Right-click File System → Add File:

Select C:\Users\%USERNAME%\AppData\Roaming\Microsoft\Windows\Libraries

Click Edit → Disable Inheritance.

Remove Write and Modify permissions for Domain Users.




✅ Effect: Users cannot create or modify .library-ms files.


---

Step 3: Restrict External Network Access via Windows Firewall (Domain-wide)

To prevent .library-ms from accessing external servers, enforce firewall rules.

1. Open GPMC and edit the GPO.


2. Navigate to:

Computer Configuration → Windows Settings → Security Settings → Windows Defender Firewall with Advanced Security → Outbound Rules


3. Right-click Outbound Rules → New Rule.


4. Choose "Program" → Enter:

C:\Windows\explorer.exe








To restrict user-created .library-ms files from accessing external server files at the domain level using Group Policy, you can implement the following strategies:

1. Disable Windows Libraries Features That Rely on Indexed File Data

By enabling the Group Policy setting "Turn off Windows Libraries features that rely on indexed file data," you can prevent libraries from displaying content that depends on indexing, which can include files from external servers.

Steps:

1. Open the Group Policy Management Console (GPMC).


2. Navigate to:

User Configuration → Administrative Templates → Windows Components → Windows Explorer


3. Locate and enable the policy:

Turn off Windows Libraries features that rely on indexed file data



Reference:

Windows Libraries | Microsoft Learn


2. Configure AppLocker to Block .library-ms Files

AppLocker can be used to prevent the execution of specific file types, including .library-ms files.

Steps:

1. In the GPMC, create or edit a Group Policy Object (GPO) linked to the desired Organizational Unit (OU).


2. Navigate to:

Computer Configuration → Windows Settings → Security Settings → Application Control Policies → AppLocker → Script Rules


3. Right-click Script Rules and select Create New Rule.


4. In the wizard, choose Deny and specify the user or group (e.g., Everyone).


5. Set the condition to Path and specify:

*\*.library-ms


6. Complete the wizard to create the rule.



Reference:

Create Your AppLocker Policies | Microsoft Learn


3. Restrict Creation of .library-ms Files Using File System Permissions

Adjusting NTFS permissions can prevent users from creating or modifying .library-ms files.

Steps:

1. In the GPMC, edit the relevant GPO.


2. Navigate to:

Computer Configuration → Policies → Windows Settings → Security Settings → File System


3. Right-click File System and select Add File.


4. Browse to:

%USERPROFILE%\AppData\Roaming\Microsoft\Windows\Libraries


5. Configure permissions to Deny Write and Modify access for standard users.



Reference:

Assign Permissions to Files & Folders using Group Policy


4. Restrict Network Access to External Servers

Implement firewall rules to prevent access to external servers.

Steps:

1. In the GPMC, edit the appropriate GPO.


2. Navigate to:

Computer Configuration → Windows Settings → Security Settings → Windows Defender Firewall with Advanced Security → Outbound Rules


3. Create a new rule to block outbound connections to specific IP addresses or ranges associated with external servers.



Reference:

Create an Outbound Program or Service Rule | Microsoft Learn


By implementing these Group Policy configurations at the domain level, you can effectively restrict the creation and use of .library-ms files that access external server files.

